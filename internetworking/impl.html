
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>3.4 Implementation Â· Computer Networks: A Systems Approach</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-block-align/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-flexible-alerts/style.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-intopic-toc/style.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-smart-nav-collapse/smart-nav-collapse.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="trend.html" />
    
    
    <link rel="prev" href="routing.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Preface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../foundation/problem.html">
            
                <a href="../foundation/problem.html">
            
                    
                    Chapter 1: Foundation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../foundation/applications.html">
            
                <a href="../foundation/applications.html">
            
                    
                    1.1 Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../foundation/requirements.html">
            
                <a href="../foundation/requirements.html">
            
                    
                    1.2 Requirements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../foundation/architecture.html">
            
                <a href="../foundation/architecture.html">
            
                    
                    1.3 Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../foundation/software.html">
            
                <a href="../foundation/software.html">
            
                    
                    1.4 Software
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../foundation/performance.html">
            
                <a href="../foundation/performance.html">
            
                    
                    1.5 Performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../foundation/trend.html">
            
                <a href="../foundation/trend.html">
            
                    
                    1.6 Broader Perspective
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../direct/problem.html">
            
                <a href="../direct/problem.html">
            
                    
                    Chapter 2: Direct Connections
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../direct/perspective.html">
            
                <a href="../direct/perspective.html">
            
                    
                    2.1 Technology Landscape
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../direct/encoding.html">
            
                <a href="../direct/encoding.html">
            
                    
                    2.2 Encoding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../direct/framing.html">
            
                <a href="../direct/framing.html">
            
                    
                    2.3 Framing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../direct/error.html">
            
                <a href="../direct/error.html">
            
                    
                    2.4 Error Detection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../direct/reliable.html">
            
                <a href="../direct/reliable.html">
            
                    
                    2.5 Reliable Transmission
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../direct/ethernet.html">
            
                <a href="../direct/ethernet.html">
            
                    
                    2.6 Multi-Access Networks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../direct/wireless.html">
            
                <a href="../direct/wireless.html">
            
                    
                    2.7 Wireless Networks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../direct/access.html">
            
                <a href="../direct/access.html">
            
                    
                    2.8 Access Networks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../direct/trend.html">
            
                <a href="../direct/trend.html">
            
                    
                    2.9 Broader Perspective
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="problem.html">
            
                <a href="problem.html">
            
                    
                    Chapter 3: Internetworking
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="switching.html">
            
                <a href="switching.html">
            
                    
                    3.1 Switching and Bridging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="basic-ip.html">
            
                <a href="basic-ip.html">
            
                    
                    3.2 Basic Internetworking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="routing.html">
            
                <a href="routing.html">
            
                    
                    3.3 Routing
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.4" data-path="impl.html">
            
                <a href="impl.html">
            
                    
                    3.4 Implementation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="trend.html">
            
                <a href="trend.html">
            
                    
                    3.5 Broader Perspective
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../scaling/problem.html">
            
                <a href="../scaling/problem.html">
            
                    
                    Chapter 4: Advanced Internetworking
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../scaling/global.html">
            
                <a href="../scaling/global.html">
            
                    
                    4.1 Global Internet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../scaling/multicast.html">
            
                <a href="../scaling/multicast.html">
            
                    
                    4.2 Multicast
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../scaling/mpls.html">
            
                <a href="../scaling/mpls.html">
            
                    
                    4.3 Multiprotocol Label Switching
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../scaling/mobile-ip.html">
            
                <a href="../scaling/mobile-ip.html">
            
                    
                    4.4 Routing Among Mobile Devices
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../scaling/trend.html">
            
                <a href="../scaling/trend.html">
            
                    
                    4.5 Broader Perspective 
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../e2e/problem.html">
            
                <a href="../e2e/problem.html">
            
                    
                    Chapter 5: End-to-End Protocols
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../e2e/udp.html">
            
                <a href="../e2e/udp.html">
            
                    
                    5.1 Simple Demultiplexor (UDP)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../e2e/tcp.html">
            
                <a href="../e2e/tcp.html">
            
                    
                    5.2 Reliable Byte Stream (TCP)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../e2e/rpc.html">
            
                <a href="../e2e/rpc.html">
            
                    
                    5.3 Remote Procedure Call
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../e2e/rtp.html">
            
                <a href="../e2e/rtp.html">
            
                    
                    5.4 Transport for Real-Time (RTP)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../e2e/trend.html">
            
                <a href="../e2e/trend.html">
            
                    
                    5.5 Broader Perspective
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../congestion/problem.html">
            
                <a href="../congestion/problem.html">
            
                    
                    Chapter 6: Congestion Control
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../congestion/issues.html">
            
                <a href="../congestion/issues.html">
            
                    
                    6.1 Issues in Resource Allocation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../congestion/queuing.html">
            
                <a href="../congestion/queuing.html">
            
                    
                    6.2 Queuing Disciplines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../congestion/tcpcc.html">
            
                <a href="../congestion/tcpcc.html">
            
                    
                    6.3 TCP Congestion Control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../congestion/avoidance.html">
            
                <a href="../congestion/avoidance.html">
            
                    
                    6.4 Advanced Congestion Control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../congestion/qos.html">
            
                <a href="../congestion/qos.html">
            
                    
                    6.5 Quality of Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../congestion/trend.html">
            
                <a href="../congestion/trend.html">
            
                    
                    6.6 Broader Perspective
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../data/problem.html">
            
                <a href="../data/problem.html">
            
                    
                    Chapter 7: End-to-End Data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../data/presentation.html">
            
                <a href="../data/presentation.html">
            
                    
                    7.1 Presentation Formatting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../data/multimedia.html">
            
                <a href="../data/multimedia.html">
            
                    
                    7.2 Multimedia Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../data/trend.html">
            
                <a href="../data/trend.html">
            
                    
                    7.3 Broader Perspective 
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../security/problem.html">
            
                <a href="../security/problem.html">
            
                    
                    Chapter 8: Network Security
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../security/trust.html">
            
                <a href="../security/trust.html">
            
                    
                    8.1 Trust and Threats
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../security/crypto.html">
            
                <a href="../security/crypto.html">
            
                    
                    8.2 Cryptographic Building Blocks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../security/key-distro.html">
            
                <a href="../security/key-distro.html">
            
                    
                    8.3 Key Predistribution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../security/authentication.html">
            
                <a href="../security/authentication.html">
            
                    
                    8.4 Authentication Protocols
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../security/systems.html">
            
                <a href="../security/systems.html">
            
                    
                    8.5 Example Systems
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../security/trend.html">
            
                <a href="../security/trend.html">
            
                    
                    8.6 Broader Perspective
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../applications/problem.html">
            
                <a href="../applications/problem.html">
            
                    
                    Chapter 9: Applications
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../applications/traditional.html">
            
                <a href="../applications/traditional.html">
            
                    
                    9.1 Traditional Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../applications/multimedia.html">
            
                <a href="../applications/multimedia.html">
            
                    
                    9.2 Multimedia Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../applications/infrastructure.html">
            
                <a href="../applications/infrastructure.html">
            
                    
                    9.3 Infrastructure Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../applications/overlays.html">
            
                <a href="../applications/overlays.html">
            
                    
                    9.4 Overlay Networks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../applications/trend.html">
            
                <a href="../applications/trend.html">
            
                    
                    9.5 Broader Perspective
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >3.4 Implementation</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="34-implementation">3.4 Implementation</h1>
<p>So far, we have talked about what switches and routers must do without
describing how they do it. There is a straightforward way to build a switch
or router: Buy a general-purpose processor and equip it with multiple 
network interfaces. Such a device, running suitable software, can 
receive packets on one of its interfaces, perform any of the switching 
or forwarding functions described in this chapter, and send packets 
out another of its interfaces. This so called <em>software switch</em> is not
too far removed from the architecture of many commercial mid- to
low-end network devices. Implementations that deliver high-end
performance typically take advantage of additional hardware
acceleration. We refer to these as <em>hardware switches</em>, although both
approaches obviously include a combination of hardware and software.</p>
<p>This section gives an overview of both software-centric and
hardware-centric designs, but it is worth noting that on the question
of switches versus routers, the distinction isn&apos;t such a big deal. It
turns out that the implementation of switches and routers have so much
in common that a network administrator typically buys a single
forwarding box and then configures it to be an L2 switch, an L3
router, or some combination of the two. Since their internal designs
are so similar, we&apos;ll use the word <em>switch</em> to cover both variants
throughout this section, avoiding the tedium of saying &quot;switch or
router&quot; all the time. We&apos;ll call out the differences between the two
when appropriate.</p>
<h2 id="software-switch">Software Switch</h2>
<p><a href="#softswitch">Figure 1</a> shows a software switch built using a
general-purpose processor with four network interface cards (NICs).
The path for a typical packet that arrives on, say, NIC 1 and is forwarded
out on NIC 2 is straightforward: as NIC 1 receives the packet it
copies its bytes directly into the main memory over the I/O bus (PCIe
in this example) using a technique called <em>direct memory access</em>
(DMA). Once the packet is in memory, the CPU examines its header to
determine which interface the packet should be sent out on, and
instructs NIC 2 to transmit the packet, again directly out of main
memory using DMA. The important take-away is that the packet is
buffered in main memory (this is the &quot;store&quot; half of
store-and-forward), with the CPU reading only the necessary header
fields into its internal registers for processing.</p>
<figure>
    <a id="softswitch"></a>
    <img src="figures/impl/Slide1.png" width="300px">
    <figcaption>A general-purpose processor used as a software
    switch.</figcaption>
</figure>

<p>There are two potential bottlenecks with this approach, one or both
of which limits the aggregate packet forwarding capacity of the
software switch.</p>
<p>The first problem is that performance is limited by the fact that all
packets must pass into and out of main memory. Your mileage will
vary based on how much you are willing to pay for hardware, but as
an example, a machine limited by a 1333-MHz, 64-bit-wide memory bus
can transmit data at a peak rate of a little over 100 Gbps&#x2014;enough to
build a switch with a handful of 10-Gbps Ethernet ports, but hardly
enough for a high-end router in the core of the Internet.</p>
<p>Moreover, this upper bound assumes that moving data is the only
problem. This is a fair approximation for long packets but a bad one
when packets are short, which is the worst-case situation switch
designers have to plan for. With minimum-sized packets, the cost of
processing each packet&#x2014;parsing its header and deciding which output
link to transmit it on&#x2014;is likely to dominate, and potentially become a
bottleneck. Suppose, for example, that a processor can perform all the
necessary processing to switch 40 million packets each second. This is
sometimes called the packet per second (pps) rate. If the average
packet is 64 bytes, this would imply</p>
<div class="ba-center"><p>Throughput = pps x BitsPerPacket</p></div>

<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>=</mo><mn>4</mn><mn>0</mn><mo>&#xD7;</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup><mo>&#xD7;</mo><mn>6</mn><mn>4</mn><mo>&#xD7;</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">
= 40 \times 10^6 \times 64 \times 8
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8641079999999999em;"></span><span class="strut bottom" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="base displaystyle textstyle uncramped"><span class="mrel">=</span><span class="mord mathrm">4</span><span class="mord mathrm">0</span><span class="mbin">&#xD7;</span><span class="mord mathrm">1</span><span class="mord"><span class="mord mathrm">0</span><span class="msupsub"><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathrm mtight">6</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mbin">&#xD7;</span><span class="mord mathrm">6</span><span class="mord mathrm">4</span><span class="mbin">&#xD7;</span><span class="mord mathrm">8</span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>=</mo><mn>2</mn><mn>0</mn><mn>4</mn><mn>8</mn><mo>&#xD7;</mo><mn>1</mn><msup><mn>0</mn><mn>7</mn></msup></mrow><annotation encoding="application/x-tex">
= 2048 \times 10^7
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8641079999999999em;"></span><span class="strut bottom" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="base displaystyle textstyle uncramped"><span class="mrel">=</span><span class="mord mathrm">2</span><span class="mord mathrm">0</span><span class="mord mathrm">4</span><span class="mord mathrm">8</span><span class="mbin">&#xD7;</span><span class="mord mathrm">1</span><span class="mord"><span class="mord mathrm">0</span><span class="msupsub"><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord mathrm mtight">7</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span></span></span></span></span></p>
<p>that is, a throughput of about 20 Gbps&#x2014;fast, but substantially below
the range users are demanding from their switches today. Bear in
mind that this 20 Gbps would be shared by all users connected to the
switch, just as the bandwidth of a single (unswitched) Ethernet
segment is shared among all users connected to the shared medium.
Thus, for example, a 16-port switch with this aggregate throughput
would only be able to cope with an average data rate of about 1 Gbps
on each port.</p>
<blockquote>
<p>These example performance numbers do not represent the absolute
maxiumum throughput rate that highly tuned software running on a
high-end server could achieve, but they are indicative of limits one
ultimately faces in pursuing this approach.</p>
</blockquote>
<p>One final consideration is important to understand when evaluating
switch implementations. The non-trivial algorithms discussed in this
chapter&#x2014;the spanning tree algorithm used by learning bridges, the
distance-vector algorithm used by RIP, and the link-state algorithm
used by OSPF&#x2014;are <em>not</em> directly part of the per-packet forwarding
decision. They run periodically in the background, but switches do
not have to execute, say, OSPF code for every packet it forwards. 
The most costly routine the CPU is likely to execute on a per-packet
basis is a table lookup, for example, looking up a VCI number in a VC
table, an IP address in an L3 forwarding table, or an Ethernet address
in an L2 forwarding table.</p>
<blockquote>
<p>[!Note|style:flat|label:Key Takeaway|iconVisibility:hidden]
The distinction between these two kinds of processing is important
enough to give it a name: the <em>control plane</em> corresponds to the
background processing required to &quot;control&quot; the network (e.g., running
OSPF, RIP, or the BGP protocol described in the next chapter) and the
<em>data plane</em> corresponds to the per-packet processing required to move
packets from input port to output port. For historical reasons,
this distinction is called <em>control plane</em> and <em>user plane</em> in
cellular access networks, but the idea is the same, and in fact, the
3GPP standard defines CUPS (Control/User Plane Separation) as an
architectural principle.</p>
<p>These two kinds of processing are easy to conflate when both run on
the same CPU, as is the case in software switch depected in
<a href="#softswitch">Figure 1</a>, but performance can be dramatically
improved by optimizing how the data plane is implemented, and
correspondingly, specifying a well-defined interface between the
control and data planes.</p>
</blockquote>
<h2 id="hardware-switch">Hardware Switch</h2>
<p>Throughout much of the Internet&apos;s history, high-performance switches and
routers have been specialized devices, built with Application-Specific
Integrated Circuits (ASICs). While it was possible to build low-end
routers and switches using commodity servers running C programs, ASICs
were required to achieve the required throughput rates.</p>
<p>The problem with ASICs is that hardware takes a long time to design
and fabricate, meaning the delay for adding new features to a
switch is usually measured in years, not the days or weeks today&apos;s
software industry is accustom to. Ideally, we&apos;d like to benefit
from the performance of ASICs and the agility of software.</p>
<p>Fortunately, recent advances in domain specific processors (and other
commodity components) have made this possible. Just as importantly,
the full architectural specification for switches that take advantage
of these new processors is now available on-line&#x2014;the hardware
equivalent of <em>open source software</em>. This means anyone can build a
high-performance switch by pulling the blueprint off the web (see the
Open Compute Project, OCP, for examples) in the same way it is possible
to build your own PC. In both cases you still need software to run on
the hardware, but just as Linux is available to run on your home-built
PC, there are now open source L2 and L3 stacks available on GitHub to
run on your home-built switch. Alternatively, you can simply buy a
pre-built switch from a commodity switch manufacturer and then load
your own software onto it. The following describes these open <em>white-box
switches</em>, so called to contrast them with closed &quot;black-box&quot; devices
that have historically dominated the industry.</p>
<figure>
    <a id="whitebox"></a>
    <img src="figures/impl/Slide2.png" width="500px">
    <figcaption>White-box switch using a Network Processing
    Unit.</figcaption>
</figure>

<p><a href="#whitebox">Figure 2</a> is a simplified depiction of a white-box
switch. The key difference from the earlier implementation on a
general-purpose processor is the addition of a Network Processoring
Unit (NPU), a domain-specific processor with an architecture and
instruction set that has been optimized for processing packet headers
(i.e., for implementing the data plane). NPUs are similar in spirit to
GPUs that have an architecture optimized for rendering computer
graphics, but in this case, the NPU is optimized for parsing packet
headers and making a forwarding decsion. NPUs are able
to process packets (input, make a forwarding decision, and output)
at rates measured in Terabits-per-second (Tbps), easily fast enough to
keep up with 32x100-Gbps ports, or the 48x40-Gbps ports shown in the
diagram.</p>
<blockquote>
<p>Our use of the term NPU is a bit non-standard. Historically, NPU was
the name given more narrowly-defined network processing chips used,
for example, to implement intelligent firewalls or deep packet
inspection. They were not as general-purpose as the NPUs we&apos;re
discussing here; nor were they as high-performance. It seems likely
that the current approach will make purpose-built network
processors obsolete, but in any case, we prefer the NPU nominclator
because it is consistent with the trend to build programmable
domain-specific processors, including GPUs for graphics and TPUs
(Tensor Processing Units) for AI.</p>
</blockquote>
<p>The beauty of this new switch design is that a given white-box can now
be programmed to be an L2 switch, and L3 router, or a combination of
both, just by a matter of programming. The exact same control plane
software stack used in a software switch still runs on the control CPU,
but in addition, data plane &quot;programs&quot; are loaded onto the NPU to reflect
the forwarding decisions made by the control plane software. Exactly
how one &quot;programs&quot; the NPU depends on the chip vendor, of which there
are currently several. In some cases, the forwarding pipeline is fixed
and the control processor merely loads the forwarding table into the
NPU (by fixed we mean the NPU only knows how to process certain headers,
like Ethernet and IP), but in other cases, the forwarding pipeline is
itself programmable. P4 is a new programming language that can be used
to program such NPU-based forwarding pipeline. Among other things, P4
tries to hide many of the differences in the underlying NPU instruction sets.</p>
<p>Internally, an NPU takes advantage of three technologies. First, a fast
SRAM-based memory buffers packets while they are being processed.
SRAM (Static Random Access Memory), is roughly an order of magnitude
faster than the DRAM (Dynamic Random Access Memory) that is used by
main memory. Second, a TCAM-based memory stores bit patterns to be
matched in the packets being processed. The &quot;CAM&quot; in TCAM stands for
&quot;Content Addressable Memory&quot; which means that the key you want to look
up in a table can effectively be used as the address into the memory
that implements the table. The &quot;T&quot; stands for &quot;Ternary&quot; which is a
fancy way to say the key you want to look up can have wildcards in it
(e.g, key <code>10*1</code> matches both <code>1001</code> and <code>1011</code>). Finally, the
processing involved to forward each packet is implemented by a
forwarding pipeline. This pipeline is implemented by an ASIC, but when
well-designed, the pipeline&apos;s forwarding behavior can be modified by
changing the program it runs. At a high level, this program is
expressed as a collection of <em>(Match, Action)</em> pairs: if you match
such-and-such field in the header, then execute this-or-that action.</p>
<p>The relevance of packet processing being implemented by a multi-stage
pipleline rather than a single-stage processor is that forwarding a
single packet likely involves looking at multiple header fields. Each stage
can be programmed to look at a different combination of fields. A
multi-stage pipeline adds a little end-to-end latency to each packet
(measured in nanoseconds), but also means that multiple packets can be
processed at the same time. For example, Stage 2 can be making a
second lookup on packet A while Stage 1 is doing an initial lookup on
packet B, and so on. This means the NPU as a whole is able to keep up
with line speeds. As of this writing, the state-of-the-art is 12.8 Tbps.</p>
<p>Finally, <a href="#whitebox">Figure 2</a> includes other commodity components
that make this all practical. In particular, it is now possible to buy
pluggable <em>transceiver</em> modules that take care of all the media access
details&#x2014;be it Gigabit Ethernet, 10-Gigabit Ethernet, or SONET&#x2014;as
well as the optics. These transceivers all conform to standardized
form factors, such as SFP+, that can in turn be connected to other
components over a standardized bus (e.g., SFI). Again, the key
takeaway is that the networking industry is just now entering into the
same commoditized world that the computing industry has enjoyed for
the last two decades.</p>
<h2 id="software-defined-networks">Software Defined Networks</h2>
<p>With switches becoming increasingly commoditized, attention is
rightfully shifting to the software that controls them. This puts us
squarely in the middle of a trend to build <em>Software Defined Networks</em>
(SDN), an idea that started to germinate about tens year ago. In fact,
it was the early stages of SDN that triggered the networking industry
to move towards white-box switches.</p>
<p>The fundamental idea of SDN is one we&apos;ve already discussed: to
decouple the network control plane (i.e., where routing algorithms
like RIP, OSPF, and BGP run) from the network data plane (i.e., where
packet forwarding decisions get made), with the former moved into
software running on commodity servers and the latter implemented by
white-box switches. The key enabling idea behind SDN was to take
this decoupling a step further, and to define a standard interface
between the control plane and the data plane. Doing so allows any
implementation of the control plane to talk to any implementation of
the data plane; this breaks the dependency on any one vendor&#x2019;s bundled
solution. The original interface is called <em>OpenFlow</em>, and this idea
of decoupling the control and data planes came to be known as
disaggregation.</p>
<blockquote>
<p>The P4 language mentioned in the previous subsection is a
second-generation tempt to define this interface by generalizing
OpenFlow.</p>
</blockquote>
<p>Another important aspect of disaggregation is that a logically
centralized control plane can be used to control a distributed network
data plane. We say logically centralized because while the state
collected by the control plane is maintained in a global data
structure, such as a Network Map, the implementation of this data
structure could still be distributed over multiple servers. For
example, it could run in a cloud. This is important for both
scalability and availability, where the key is that the two planes are
configured and scaled independent of each other. This idea took off
quickly in the cloud, where today&#x2019;s cloud providers run SDN-based
solutions both within their datacenters and across the backbone
networks that interconnect their datacenters.</p>
<p>One consequence of this design that isn&#x2019;t immediately obvious is that
a logically centralized control plane doesn&#x2019;t just manage a network of
physical (hardware) switches that interconnects physical servers, but
it also manages a network of virtual (software) switches that
interconnect virtual servers (e.g., Virtual Machines and containers).
If you&#x2019;re counting &#x201C;switch ports&#x201D; (a good measure of all the devices
connected to your network) then the number of virtual ports in the
Internet rocketed past the number of physical ports in 2012.</p>
<figure>
    <a id="sdn"></a>
    <img src="figures/impl/Slide3.png" width="500px">
    <figcaption>Network Operating System (NOS) hosting a set of 
    control applications and providing a logically centralized point 
    of control for an underlying network data plane.</figcaption>
</figure>

<p>One of other key enablers for SDN&#x2019;s success, as depicted in
<a href="#sdn">Figure 3</a>, is the Network Operating System (NOS). Like a server
operating system (e.g., Linux, IOS, Android, Windows) that provides a
set of high-level abstractions that make it easier to implement
applications (e.g., you can read and write files instead of directly
accessing disk drives), a NOS makes it easier to implement network
control functionality, otherwise known as <em>Control Apps</em>. A good NOS
abstracts the details of the network switches and provides a <em>Network
Map</em> abstraction to the application developer. The NOS detects changes
in the underlying network (e.g., switches, ports, and links going
up-and-down) and the control application simply implements the
behavior it wants on this abstract graph. What that means is that the
NOS takes on the burden of collecting network state (the hard part of
distributed algorithms like Link-State and Distance-Vector algorithms)
and the app is free to simply implement the shortest path algorithm
and load the forwarding rules into the underlying switches. By
centralizing this logic, the goal is to come up with a globally
optimized solution. The published evidence from cloud providers that
have embraced this approach confirms this advantage.</p>
<p>As much of an advantage as the cloud providers have been able to get
out of SDN, its adoption in enterprises and Telcos has much much
slower. This is partly about the ability of different markets to
manage their networks. The Googles, Microsofts, and Amazons of the
world have the engineers and DevOps skills needed to take advantage of
this technology, whereas others still prefer pre-packaged and
integrated solutions that support the management and command line
interfaces they are familiar with.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="routing.html" class="navigation navigation-prev " aria-label="Previous page: 3.3 Routing">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="trend.html" class="navigation navigation-next " aria-label="Next page: 3.5 Broader Perspective">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"3.4 Implementation","level":"1.4.4","depth":2,"next":{"title":"3.5 Broader Perspective","level":"1.4.5","depth":2,"path":"internetworking/trend.md","ref":"internetworking/trend.md","articles":[]},"previous":{"title":"3.3 Routing","level":"1.4.3","depth":2,"path":"internetworking/routing.md","ref":"internetworking/routing.md","articles":[]},"dir":"ltr"},"config":{"plugins":["anchorjs","katex","block-align","flexible-alerts","sequence-diagrams","creativecommons","intopic-toc","custom-favicon","smart-nav-collapse"],"root":".","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css"},"pluginsConfig":{"intopic-toc":{"label":"Content","selector":".markdown-section h2","visible":true},"block-align":{},"search":{},"sequence-diagrams":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"favicon":"bridge.ico","custom-favicon":{},"creativecommons":{},"flexible-alerts":{"danger":{"className":"danger","icon":"fa fa-ban","label":"Attention"},"note":{"className":"info","icon":"fa fa-info-circle","label":"Note"},"style":"callout","tip":{"className":"tip","icon":"fa fa-lightbulb-o","label":"Tip"},"warning":{"className":"warning","icon":"fa fa-exclamation-triangle","label":"Warning"}},"smart-nav-collapse":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchorjs":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"branch":"master"},"title":"Computer Networks: A Systems Approach","gitbook":"*"},"file":{"path":"internetworking/impl.md","mtime":"2019-05-28T18:17:20.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-05-28T20:44:34.155Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-anchorjs/anchor.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-anchorjs/anchor-style.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-flexible-alerts/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-intopic-toc/anchor.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-intopic-toc/gumshoe.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-intopic-toc/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-smart-nav-collapse/smart-nav-collapse.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

