
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>1.4 Software Â· Computer Networks: A Systems Approach</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-block-align/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-smart-nav-collapse/smart-nav-collapse.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="performance.html" />
    
    
    <link rel="prev" href="architecture.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Preface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="problem.html">
            
                <a href="problem.html">
            
                    
                    Chapter 1: Foundation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="applications.html">
            
                <a href="applications.html">
            
                    
                    1.1 Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="requirements.html">
            
                <a href="requirements.html">
            
                    
                    1.2 Requirements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="architecture.html">
            
                <a href="architecture.html">
            
                    
                    1.3 Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.4" data-path="software.html">
            
                <a href="software.html">
            
                    
                    1.4 Software
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="performance.html">
            
                <a href="performance.html">
            
                    
                    1.5 Performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="summary.html">
            
                <a href="summary.html">
            
                    
                    1.6 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../direct/problem.html">
            
                <a href="../direct/problem.html">
            
                    
                    Chapter 2: Direct Connections
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../direct/perspective.html">
            
                <a href="../direct/perspective.html">
            
                    
                    2.1 Technology Landscape
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../direct/encoding.html">
            
                <a href="../direct/encoding.html">
            
                    
                    2.2 Encoding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../direct/framing.html">
            
                <a href="../direct/framing.html">
            
                    
                    2.3 Framing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../direct/error.html">
            
                <a href="../direct/error.html">
            
                    
                    2.4 Error Detection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../direct/reliable.html">
            
                <a href="../direct/reliable.html">
            
                    
                    2.5 Reliable Transmission
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../direct/ethernet.html">
            
                <a href="../direct/ethernet.html">
            
                    
                    2.6 Multi-Access Networks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../direct/wireless.html">
            
                <a href="../direct/wireless.html">
            
                    
                    2.7 Wireless Networks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../direct/access.html">
            
                <a href="../direct/access.html">
            
                    
                    2.8 Access Networks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../direct/summary.html">
            
                <a href="../direct/summary.html">
            
                    
                    2.9 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../internetworking/problem.html">
            
                <a href="../internetworking/problem.html">
            
                    
                    Chapter 3: Internetworking
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../internetworking/switching.html">
            
                <a href="../internetworking/switching.html">
            
                    
                    3.1 Switching and Bridging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../internetworking/basic-ip.html">
            
                <a href="../internetworking/basic-ip.html">
            
                    
                    3.2 Basic Internetworking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../internetworking/routing.html">
            
                <a href="../internetworking/routing.html">
            
                    
                    3.3 Routing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../internetworking/impl.html">
            
                <a href="../internetworking/impl.html">
            
                    
                    3.4 Implementation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../internetworking/summary.html">
            
                <a href="../internetworking/summary.html">
            
                    
                    3.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../scaling/problem.html">
            
                <a href="../scaling/problem.html">
            
                    
                    Chapter 4: Advanced Internetworking
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../scaling/global.html">
            
                <a href="../scaling/global.html">
            
                    
                    4.1 Global Internet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../scaling/multicast.html">
            
                <a href="../scaling/multicast.html">
            
                    
                    4.2 Multicast
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../scaling/mpls.html">
            
                <a href="../scaling/mpls.html">
            
                    
                    4.3 Multiprotocol Label Switching
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../scaling/mobile-ip.html">
            
                <a href="../scaling/mobile-ip.html">
            
                    
                    4.4 Routing Among Mobile Devices
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../scaling/summary.html">
            
                <a href="../scaling/summary.html">
            
                    
                    4.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../e2e/problem.html">
            
                <a href="../e2e/problem.html">
            
                    
                    Chapter 5: End-to-End Protocols
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../e2e/udp.html">
            
                <a href="../e2e/udp.html">
            
                    
                    5.1 Simple Demultiplexor (UDP)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../e2e/tcp.html">
            
                <a href="../e2e/tcp.html">
            
                    
                    5.2 Reliable Byte Stream (TCP)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../e2e/rpc.html">
            
                <a href="../e2e/rpc.html">
            
                    
                    5.3 Remote Procedure Call
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../e2e/rtp.html">
            
                <a href="../e2e/rtp.html">
            
                    
                    5.4 Transport for Real-Time Applications (RTP)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../e2e/summary.html">
            
                <a href="../e2e/summary.html">
            
                    
                    5.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../congestion/problem.html">
            
                <a href="../congestion/problem.html">
            
                    
                    Chapter 6: Congestion Control and Resource Allocation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../congestion/issues.html">
            
                <a href="../congestion/issues.html">
            
                    
                    6.1 Issues in Resource Allocation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../congestion/queuing.html">
            
                <a href="../congestion/queuing.html">
            
                    
                    6.2 Queuing Disciplines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../congestion/tcpcc.html">
            
                <a href="../congestion/tcpcc.html">
            
                    
                    6.3 TCP Congestion Control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../congestion/avoidance.html">
            
                <a href="../congestion/avoidance.html">
            
                    
                    6.4 Congestion-Avoidance Mechanisms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../congestion/qos.html">
            
                <a href="../congestion/qos.html">
            
                    
                    6.5 Quality of Service
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../congestion/summary.html">
            
                <a href="../congestion/summary.html">
            
                    
                    6.6 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../data/problem.html">
            
                <a href="../data/problem.html">
            
                    
                    Chapter 7: End-to-End Data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../data/presentation.html">
            
                <a href="../data/presentation.html">
            
                    
                    7.1 Presentation Formatting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../data/multimedia.html">
            
                <a href="../data/multimedia.html">
            
                    
                    7.2 Multimedia Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../data/summary.html">
            
                <a href="../data/summary.html">
            
                    
                    7.3 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../security/problem.html">
            
                <a href="../security/problem.html">
            
                    
                    Chapter 8: Network Security
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../security/crypto.html">
            
                <a href="../security/crypto.html">
            
                    
                    8.1 Cryptographic Building Blocks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../security/key-distro.html">
            
                <a href="../security/key-distro.html">
            
                    
                    8.2 Key Predistribution
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../security/authentication.html">
            
                <a href="../security/authentication.html">
            
                    
                    8.3 Authentication Protocols
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../security/systems.html">
            
                <a href="../security/systems.html">
            
                    
                    8.4 Example Systems
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../security/summary.html">
            
                <a href="../security/summary.html">
            
                    
                    8.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../applications/problem.html">
            
                <a href="../applications/problem.html">
            
                    
                    Chapter 9: Applications
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../applications/traditional.html">
            
                <a href="../applications/traditional.html">
            
                    
                    9.1 Traditional Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../applications/multimedia.html">
            
                <a href="../applications/multimedia.html">
            
                    
                    9.2 Multimedia Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../applications/infrastructure.html">
            
                <a href="../applications/infrastructure.html">
            
                    
                    9.3 Infrastructure Applications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../applications/overlays.html">
            
                <a href="../applications/overlays.html">
            
                    
                    9.4 Overlay Networks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../applications/summary.html">
            
                <a href="../applications/summary.html">
            
                    
                    9.5 Summary
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >1.4 Software</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="14-software">1.4 Software</h1>
<p>Network architectures and protocol specifications are essential things,
but a good blueprint is not enough to explain the phenomenal success of
the Internet: The number of computers connected to the Internet has
grown exponentially for almost 3 decades (although precise numbers are
now hard to come by). The number of users of the Internet was estimated
to be around 4.1 billion by the end of 2017&#x2014;roughly half of the
world&apos;s population.</p>
<p>What explains the success of the Internet? There are certainly many
contributing factors (including a good architecture), but one thing that
has made the Internet such a runaway success is the fact that so much of
its functionality is provided by software running in general-purpose
computers. The significance of this is that new functionality can be
added readily with &quot;just a small matter of programming.&quot; As a result,
new applications and services have been showing up at an incredible
pace.</p>
<p>A related factor is the massive increase in computing power available in
commodity machines. Although computer networks have always been capable
in principle of transporting any kind of information, such as digital
voice samples, digitized images, and so on, this potential was not
particularly interesting if the computers sending and receiving that
data were too slow to do anything useful with the information. Virtually
all of today&apos;s computers are capable of playing back digitized audio
and video at a speed and resolution that are quite useable.</p>
<p>In the years since the first edition of this book appeared, the writing
of networked applications has become a much more mainstream activity and
less a job just for a few specialists. Many factors have played into
this, including better tools to make the job easier for nonspecialists
and the opening up of new markets such as applications for smartphones.</p>
<p>The point to note is that knowing how to implement network software is
an essential part of understanding computer networks, and while the odds
are you will not be tasked to implement a low-level protocol like IP,
there is a good chance you will find reason to implement an
application-level protocol&#x2014;the elusive &quot;killer app&quot; that will lead to
unimaginable fame and fortune. To get you started, this section
introduces some of the issues involved in implementing a network
application on top of the Internet. Typically, such programs are
simultaneously an application (i.e., designed to interact with users)
and a protocol (i.e., communicates with peers across the network).</p>
<h2 id="application-programming-interface-sockets">Application Programming Interface (Sockets)</h2>
<p>The place to start when implementing a network application is the
interface exported by the network. Since most network protocols are in
software (especially those high in the protocol stack), and nearly all
computer systems implement their network protocols as part of the
operating system, when we refer to the interface &quot;exported by the
network,&quot; we are generally referring to the interface that the OS
provides to its networking subsystem. This interface is often called the
network <em>application programming interface</em> (API).</p>
<p>Although each operating system is free to define its own network API
(and most have), over time certain of these APIs have become widely
supported; that is, they have been ported to operating systems other
than their native system. This is what has happened with the <em>socket
interface</em> originally provided by the Berkeley distribution of Unix,
which is now supported in virtually all popular operating systems, and
is the foundation of language-specific interfaces, such as the Java or
Python socket library. The advantages of industry-wide support for a
single API are that applications can be easily ported from one OS to
another and developers can easily write applications for multiple
operating systems.</p>
<blockquote>
<p>Not wanting to pick sides in a Java-v-Python-v-Go debate, and
because it remains the language of choice for network internals, all
of the code examples given in this book are written in C and directly
use OS-level interfaces.</p>
</blockquote>
<p>Before describing the socket interface, it is important to keep two
concerns separate in your mind. Each protocol provides a certain set of
<em>services</em>, and the API provides a <em>syntax</em> by which those services can
be invoked on a particular computer system. The implementation is then
responsible for mapping the tangible set of operations and objects
defined by the API onto the abstract set of services defined by the
protocol. If you have done a good job of defining the interface, then it
will be possible to use the syntax of the interface to invoke the
services of many different protocols. Such generality was certainly a
goal of the socket interface, although it&apos;s far from perfect.</p>
<p>The main abstraction of the socket interface, not surprisingly, is the
<em>socket</em>. A good way to think of a socket is as the point where a local
application process attaches to the network. The interface defines
operations for creating a socket, attaching the socket to the network,
sending/receiving messages through the socket, and closing the socket.
To simplify the discussion, we will limit ourselves to showing how
sockets are used with TCP.</p>
<p>The first step is to create a socket, which is done with the following
operation:</p>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">socket</span><span class="hljs-params">(<span class="hljs-keyword">int</span> domain, <span class="hljs-keyword">int</span> type, <span class="hljs-keyword">int</span> protocol)</span>
</span></code></pre>
<p>The reason that this operation takes three arguments is 
that the socket interface was designed to be general enough to 
support any underlying protocol suite. Specifically, the 
<code>domain</code> argument specifies the protocol <em>family</em>
that is going to be used: <code>PF_INET</code> denotes the Internet 
family, <code>PF_UNIX</code> denotes the Unix pipe facility, and 
<code>PF_PACKET</code> denotes direct access to the network interface 
(i.e., it bypasses the TCP/IP protocol stack). The <code>type</code>
argument indicates the semantics of the communication. 
<code>SOCK_STREAM</code> is used to denote a byte stream. 
<code>SOCK_DGRAM</code> is an alternative that denotes a 
message-oriented service, such as that provided by UDP.  The 
<code>protocol</code> argument identifies the specific protocol that 
is going to be used. In our case, this argument is <code>UNSPEC</code>
because the combination of <code>PF_INET</code> and 
<code>SOCK_STREAM</code> implies TCP.  Finally, the return value from 
<code>socket</code> is a <em>handle</em> for the newly created 
socket&#x2014;that is, an identifier by which we can refer to the 
socket in the future. It is given as an argument to subsequent 
operations on this socket.</p>
<p>The next step depends on whether you are a client or a server. On a
server machine, the application process performs a <em>passive</em> open&#x2014;the
server says that it is prepared to accept connections, but it does not
actually establish a connection. The server does this by invoking the
following three operations:</p>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">bind</span><span class="hljs-params">(<span class="hljs-keyword">int</span> socket, <span class="hljs-keyword">struct</span> sockaddr *address, <span class="hljs-keyword">int</span> addr_len)</span>
<span class="hljs-keyword">int</span> <span class="hljs-title">listen</span><span class="hljs-params">(<span class="hljs-keyword">int</span> socket, <span class="hljs-keyword">int</span> backlog)</span>
<span class="hljs-keyword">int</span> <span class="hljs-title">accept</span><span class="hljs-params">(<span class="hljs-keyword">int</span> socket, <span class="hljs-keyword">struct</span> sockaddr *address, <span class="hljs-keyword">int</span> *addr_len)</span>
</span></code></pre>
<p>The <code>bind</code> operation, as its name suggests, binds the newly 
created <code>socket</code> to the specified <code>address</code>. This is 
the network address of the <em>local</em> participant&#x2014;the 
server. Note that, when used with the Internet protocols,
<code>address</code> is a data structure that includes both the IP 
address of the server and a TCP port number. Ports are used to
indirectly identify processes. They are a form of <em>demux keys</em>.  The
port number is usually some well-known number specific to the service
being offered; for example, web servers commonly accept connections on
port 80. </p>
<p>The <code>listen</code> operation then defines how many connections 
can be pending on the specified <code>socket</code>. Finally, the 
<code>accept</code> operation carries out the passive open. It is a 
blocking operation that does not return until a remote participant 
has established a connection, and when it does complete it returns 
a <em>new</em> socket that corresponds to this just-established 
connection, and the <code>address</code> argument contains the 
<em>remote</em> participant&apos;s address.  Note that when 
<code>accept</code> returns, the original socket that was given as an 
argument still exists and still corresponds to the passive open;
it is used in future invocations of <code>accept</code>. </p>
<p>On the client machine, the application process performs an 
<em>active</em> open; that is, it says who it wants to communicate 
with by invoking the following single operation:</p>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">connect</span><span class="hljs-params">(<span class="hljs-keyword">int</span> socket, <span class="hljs-keyword">struct</span> sockaddr *address, <span class="hljs-keyword">int</span> addr_len)</span>
</span></code></pre>
<p>This operation does not return until TCP has 
successfully established a connection, at which time the 
application is free to begin sending data. In this case,
<code>address</code> contains the remote participant&apos;s address. In 
practice, the client usually specifies only the remote 
participant&apos;s address and lets the system fill in the local 
information.  Whereas a server usually listens for messages on a 
well-known port, a client typically does not care which port it 
uses for itself; the OS simply selects an unused one. </p>
<p>Once a connection is established, the application processes invoke 
the following two operations to send and receive data:</p>
<pre><code class="lang-c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">send</span><span class="hljs-params">(<span class="hljs-keyword">int</span> socket, <span class="hljs-keyword">char</span> *message, <span class="hljs-keyword">int</span> msg_len, <span class="hljs-keyword">int</span> flags)</span>
<span class="hljs-keyword">int</span> <span class="hljs-title">recv</span><span class="hljs-params">(<span class="hljs-keyword">int</span> socket, <span class="hljs-keyword">char</span> *buffer, <span class="hljs-keyword">int</span> buf_len, <span class="hljs-keyword">int</span> flags)</span>
</span></code></pre>
<p>The first operation sends the given <code>message</code>
over the specified <code>socket</code>, while the second operation 
receives a message from the specified <code>socket</code> into the 
given <code>buffer</code>. Both operations take a set of 
<code>flags</code> that control certain details of the operation. </p>
<h2 id="example-application">Example Application</h2>
<p>We now show the implementation of a simple client/server program that
uses the socket interface to send messages over a TCP connection. The
program also uses other Unix networking utilities, which we introduce as
we go. Our application allows a user on one machine to type in and send
text to a user on another machine. It is a simplified version of the
Unix <code>talk</code> program, which is similar to the program at the core of an
instant messaging application.</p>
<h3 id="client">Client</h3>
<p>We start with the client side, which takes the name of the remote
machine as an argument. It calls the Unix utility to translate this name
into the remote host&apos;s IP address. The next step is to construct the
address data structure (<code>sin</code>) expected by the socket interface. Notice that
this data structure specifies that we&apos;ll be using the socket to connect
to the Internet (<code>AF_INET</code>). In our example, we use TCP port 5432 as
the well-known server port; this happens to be a port that has not
been assigned to any other Internet service. The final step in setting
up the connection is to call <code>socket</code> and <code>connect</code>. Once the
operation returns, the connection is established and the client
program enters its main loop, which reads text from standard
input and sends it over the socket.</p>
<pre><code class="lang-c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/socket.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;netinet/in.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;netdb.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SERVER_PORT 5432</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_LINE 256</span>

<span class="hljs-function"><span class="hljs-keyword">int</span>
<span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> * argv[])</span>
</span>{
  FILE *fp;
  <span class="hljs-keyword">struct</span> hostent *hp;
  <span class="hljs-keyword">struct</span> sockaddr_in <span class="hljs-built_in">sin</span>;
  <span class="hljs-keyword">char</span> *host;
  <span class="hljs-keyword">char</span> buf[MAX_LINE];
  <span class="hljs-keyword">int</span> s;
  <span class="hljs-keyword">int</span> len;

  <span class="hljs-keyword">if</span> (argc==<span class="hljs-number">2</span>) {
    host = argv[<span class="hljs-number">1</span>];
  }
  <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;usage: simplex-talk host\n&quot;</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
  }

  <span class="hljs-comment">/* translate host name into peer&apos;s IP address */</span>
  hp = gethostbyname(host);
  <span class="hljs-keyword">if</span> (!hp) {
    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;simplex-talk: unknown host: %s\n&quot;</span>, host);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
  }

  <span class="hljs-comment">/* build address data structure */</span>
  bzero((<span class="hljs-keyword">char</span> *)&amp;<span class="hljs-built_in">sin</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-built_in">sin</span>));
  <span class="hljs-built_in">sin</span>.sin_family = AF_INET;
  bcopy(hp-&gt;h_addr, (<span class="hljs-keyword">char</span> *)&amp;<span class="hljs-built_in">sin</span>.sin_addr, hp-&gt;h_length);
  <span class="hljs-built_in">sin</span>.sin_port = htons(SERVER_PORT);

  <span class="hljs-comment">/* active open */</span>
  <span class="hljs-keyword">if</span> ((s = socket(PF_INET, SOCK_STREAM, <span class="hljs-number">0</span>)) &lt; <span class="hljs-number">0</span>) {
    perror(<span class="hljs-string">&quot;simplex-talk: socket&quot;</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
  }
  <span class="hljs-keyword">if</span> (connect(s, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;<span class="hljs-built_in">sin</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-built_in">sin</span>)) &lt; <span class="hljs-number">0</span>)
  {
    perror(<span class="hljs-string">&quot;simplex-talk: connect&quot;</span>);
    close(s);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
  }
  <span class="hljs-comment">/* main loop: get and send lines of text */</span>
  <span class="hljs-keyword">while</span> (fgets(buf, <span class="hljs-keyword">sizeof</span>(buf), <span class="hljs-built_in">stdin</span>)) {
    buf[MAX_LINE<span class="hljs-number">-1</span>] = <span class="hljs-string">&apos;\0&apos;</span>;
    len = <span class="hljs-built_in">strlen</span>(buf) + <span class="hljs-number">1</span>;
    send(s, buf, len, <span class="hljs-number">0</span>);
  }
}
</code></pre>
<h3 id="server">Server</h3>
<p>The server is equally simple. It first constructs the address data
structure by filling in its own port number (<code>SERVER_PORT</code>). By not
specifying an IP address, the application program is willing to accept
connections on any of the local host&apos;s IP addresses. Next, the server
performs the preliminary steps involved in a passive open; it creates
the socket, binds it to the local address, and sets the maximum number
of pending connections to be allowed. Finally, the main loop waits for
a remote host to try to connect, and when one does, it receives and
prints out the characters that arrive on the connection.</p>
<pre><code class="lang-c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/socket.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;netinet/in.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;netdb.h&gt;</span></span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SERVER_PORT  5432</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_PENDING  5</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_LINE     256</span>

<span class="hljs-function"><span class="hljs-keyword">int</span>
<span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">struct</span> sockaddr_in <span class="hljs-built_in">sin</span>;
  <span class="hljs-keyword">char</span> buf[MAX_LINE];
  <span class="hljs-keyword">int</span> len;
  <span class="hljs-keyword">int</span> s, new_s;

  <span class="hljs-comment">/* build address data structure */</span>
  bzero((<span class="hljs-keyword">char</span> *)&amp;<span class="hljs-built_in">sin</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-built_in">sin</span>));
  <span class="hljs-built_in">sin</span>.sin_family = AF_INET;
  <span class="hljs-built_in">sin</span>.sin_addr.s_addr = INADDR_ANY;
  <span class="hljs-built_in">sin</span>.sin_port = htons(SERVER_PORT);

  <span class="hljs-comment">/* setup passive open */</span>
  <span class="hljs-keyword">if</span> ((s = socket(PF_INET, SOCK_STREAM, <span class="hljs-number">0</span>)) &lt; <span class="hljs-number">0</span>) {
    perror(<span class="hljs-string">&quot;simplex-talk: socket&quot;</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
  }
  <span class="hljs-keyword">if</span> ((bind(s, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;<span class="hljs-built_in">sin</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-built_in">sin</span>))) &lt; <span class="hljs-number">0</span>) {
    perror(<span class="hljs-string">&quot;simplex-talk: bind&quot;</span>);
    <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
  }
  listen(s, MAX_PENDING);

 <span class="hljs-comment">/* wait for connection, then receive and print text */</span>
  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) {
    <span class="hljs-keyword">if</span> ((new_s = accept(s, (<span class="hljs-keyword">struct</span> sockaddr *)&amp;<span class="hljs-built_in">sin</span>, &amp;len)) &lt; <span class="hljs-number">0</span>) {
      perror(<span class="hljs-string">&quot;simplex-talk: accept&quot;</span>);
      <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);
    }
    <span class="hljs-keyword">while</span> (len = recv(new_s, buf, <span class="hljs-keyword">sizeof</span>(buf), <span class="hljs-number">0</span>))
      <span class="hljs-built_in">fputs</span>(buf, <span class="hljs-built_in">stdout</span>);
    close(new_s);
  }
}
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="architecture.html" class="navigation navigation-prev " aria-label="Previous page: 1.3 Architecture">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="performance.html" class="navigation navigation-next " aria-label="Next page: 1.5 Performance">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"1.4 Software","level":"1.2.4","depth":2,"next":{"title":"1.5 Performance","level":"1.2.5","depth":2,"path":"foundation/performance.md","ref":"foundation/performance.md","articles":[]},"previous":{"title":"1.3 Architecture","level":"1.2.3","depth":2,"path":"foundation/architecture.md","ref":"foundation/architecture.md","articles":[]},"dir":"ltr"},"config":{"plugins":["anchorjs","katex","block-align","sequence-diagrams","creativecommons","custom-favicon","smart-nav-collapse"],"root":".","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css"},"pluginsConfig":{"block-align":{},"search":{},"sequence-diagrams":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"favicon":"bridge.ico","custom-favicon":{},"creativecommons":{},"smart-nav-collapse":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchorjs":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"branch":"master"},"title":"Computer Networks: A Systems Approach","gitbook":"*"},"file":{"path":"foundation/software.md","mtime":"2018-08-27T23:22:41.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-08-28T17:17:09.677Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-anchorjs/anchor-style.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-smart-nav-collapse/smart-nav-collapse.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

